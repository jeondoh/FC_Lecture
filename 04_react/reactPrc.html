<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <!-- RESET CSS CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css">
  <!-- REACT CDN -->
  <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <!-- BABEL  -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <title>React</title>

  <style>
    #root p {
      color: white;
      font-size: 20px;
      background-color: green;
      text-align: center;
      width: 200px;
    }
    #btn_plus{
      background-color: red;
      border: 2px solid #000000;
      font-size: 15px;
      width: 200px;
    }
  </style>

</head>
<body>

  <div id="root">
  </div>
  <button id="btn_plus">+</button>

  <script type="text/babel">
    /*
    const root = document.querySelector('#root')
    const btn_plus = document.querySelector('#btn_plus')

    let i = 0;

    root.innerHTML = '<p>init : 0</p>'
    btn_plus.addEventListener('click', () => {
      root.innerHTML = `<p>init : ${i++}</p>`
    })
    */
    /*
    const component = {
      message: 'init',
      count: 0,
      render(){
        return `<p>${this.message} : ${this.count}</p>`
      }
    };
    function render(rootElement, component){
      rootElement.innerHTML = component.render();
    }
    render(document.querySelector('#root'), component) // 초기화

    document.querySelector('#btn_plus').addEventListener('click', () => {
      component.message = 'update';
      component.count += 1;
      render(document.querySelector('#root'), component)
    });

    const Component = props => {
      return React.createElement('p', null, `${props.message} : ${props.count}`)
    }
    ReactDOM.render(
        React.createElement(Component, {message: 'init', count: 0}, null),
        document.querySelector('#root')
    );

    document.querySelector('#btn_plus').addEventListener('click', () => {
      ReactDOM.render(
          React.createElement(Component, {message: 'update', count: 10}, null),
          document.querySelector('#root')
      );
    });
    */
    /*
    // 정의1
    class ClassComponent extends React.Component {
      render(){
        return <div>Hello</div>;
      }
    }
    // 사용1
    ReactDOM.render(<ClassComponent/>, document.querySelector('#root'))
    */

    /*
    // 정의2
    function FunctionComponent(){
      return <div>Hello</div>;
    }
    // 사용2
    ReactDOM.render(<FunctionComponent/>, document.querySelector('#root'))
    */
    /*
    // 정의3
    const FunctionComponent = () => <div>Hello</div>;
    // 사용3
    ReactDOM.render(<FunctionComponent/>, document.querySelector('#root'))
    */

    /*
    React.createElement(
        type, // 태그 이름 문자열 | 리액트 컴포넌트 | React.Fragment
        [props], // 리액트 컴포넌트에 넣어주는 데이터 객체
        [...children] // 자식으로 넣어주는 요소들
    );
    */
    /*
    // 1. 태그 이름 문자열 type
    ReactDOM.render(
        React.createElement('h1', null, 'type이 "태그 이름 문자열" 입니다.'), // <h1>type이 "태그 이름 문자열" 입니다.</h1>
        document.querySelector("#root")
    )
    */
    /*
    // 2. 리액트 컴포넌트 type
    const Component = () => {
      return React.createElement('p', null, 'type 이 "React 컴포넌트" 입니다.')
    };

    ReactDOM.render(
        React.createElement(Component, null, null), // <Component></Component>
        document.querySelector("#root")
    );
    */
    // 3. React.Fragment
    /*
    ReactDOM.render(
        React.createElement(
            React.Fragment,
            null,
            'type이 "React Fragment 입니다."'
        ),
        document.querySelector("#root")
    )
    */

    /*
    // 4. 복잡한 리액트 엘리먼트 모임 (createElement의 한계)
    // <div>
    //   <div>
    //     <h1>주제</h1>
    //     <ul>
    //       <li>React</li>
    //       <li>Vue</li>
    //     </ul>
    //   </div>
    // </div>

    ReactDOM.render(
        React.createElement("div", null,
            React.createElement('div', null,
                React.createElement('h1', null, "주제"),
                React.createElement('ul', null,
                    React.createElement("li", null , "React"),
                    React.createElement("li", null , "Vue")
                )
            )
        ),
        document.querySelector("#root")
    )
    */

    /*
    // 5. JSX
    // 우리가 작성한 어떤 코드 > 순수하게 실행할 수 있는 자바스크립트
    // babel

    const title = "주제"

    ReactDOM.render(
        <div>
          <div>
            <h1>{title}</h1>
            <ul>
              <li>React</li>
              <li>Vue</li>
            </ul>
          </div>
        </div>,
        document.querySelector("#root")
    );
    */

    // props와 state
    /*
    function Component(props){
      return (
        <div>
          <h1>{props.message} 이것은 함수로 만든 컴포넌트 입니다.</h1>
        </div>
      );
    }
    */
    /*
    class Component extends React.Component{
      // state 설정 정의1

      // state = {
      //   count: 0,
      // }

      // state 설정 정의2
      constructor(props) {
        super(props);

        this.state = {count: 0};
      }

      render(){
        return (
            <div>
              <h1>{this.props.message} 이것은 클래스로 만든 컴포넌트 입니다.</h1>
            <p>{this.state.count}</p>
            </div>
        );
      }

      componentDidMount(){
        setTimeout(() => {
          // this.state.count+= 1;
          // this.setState({
          //   count: this.state.count + 1,
          // });
          this.setState((previousState) => {
            return {count: previousState.count + 1};
          })
        }, 1000);
      }

      // props가 빈값일때 기본값 설정1
      static defaultProps = {
        message: "기본값",
      }
    }
    // props가 빈값일때 기본값 설정2
    Component.defaultProps = {
      message: "기본값2",
    }

    ReactDOM.render(
        <Component message="안녕하세요@@" />,
        document.querySelector("#root")
    )
    */
    /*
    function Component(){
      return (
      <div>
        <button onClick={() => {console.log("Clicked")}}>클릭</button>
      </div>
      );
    }
    */

    /*
    class Component extends React.Component{
      state = {
        count: 0,
      };
      render(){
        return (
            <div>
              <p>{this.state.count}</p>
              <button onClick={this.click}>클릭</button>
            </div>
        );
      }

      click = () =>{
        console.log("Clicked");
        this.setState(state => ({...state, count: state.count + 1}));
      }
    }

    ReactDOM.render(<Component/>, document.querySelector("#root"));
     */

    /*
    // 컴포넌트 생명주기
    // 1. Component 생성 및 마운트(<v16.3)
    // 2. Component props, state 변경(<v16.3)
    class App extends React.Component{
      state = {
        age: 39,
      };
      interval = null;

      constructor(props) {
        super(props);
        console.log("constructor", props);
      }
      render(){
        console.log("render")
        return (
            <div>
              <h2>Hello {this.props.name} - {this.state.age}</h2>
            </div>
        )
      }
      componentWillMount(){
        console.log('componentWillMount')
      }
      componentDidMount(){
        console.log('componentDidMount')
        this.interval = setInterval(() =>{
          this.setState(state => ({...state, age: state.age + 1}));
        }, 1000)
      }

      componentWillReceiveProps(nextProps){
        console.log('componentWillReceiveProps', nextProps)
      }
      shouldComponentUpdate(nextProps, nextState){
        console.log('shouldComponentUpdate', nextProps, nextState)
        // return false일 경우 render를 재실행 하지 않음
        return true;
      }
      componentWillUpdate(nextProps, nextState){
        console.log('componentWillUpdate', nextProps, nextState)
      }
      componentDidUpdate(prevProps, prevState){
        console.log('componentDidUpdate', prevProps, prevState)
      }

      componentWillUnmount(){
        clearInterval(this.interval);
        console.log('componentWillUnmount')
      }

    }
     */
    // 3. 이후버전(v16.3)
    let i = 0;

    class App extends React.Component{
      state = {list: []};
      render(){
        return (
            <div id="list" style={{height: 100, overflow: 'scroll'}}>
              {this.state.list.map(i => {
                return <div>{i}</div>
              })}
            </div>
        )
      }
      componentDidMount(){
        setInterval(() => {
          this.setState(state => ({
            list: [...state.list, i++],
          }))
        }, 1000)
      }

      getSnapshotBeforeUpdate(prevProps, prevState){
        if(prevState.list.length === this.state.list.length) return null
        const list = document.querySelector('#list');
        return list.scrollHeight - list.scrollTop;
      }
      // 스크롤 위치
      componentDidUpdate(prevProps, prevState, snapshot){
        console.log(snapshot)
        if(snapshot === null) return;
        const list = document.querySelector('#list');
        list.scrollTop = list.scrollHeight - snapshot;
      }
    }

    ReactDOM.render(<App name="Mark"/>, document.querySelector("#root"))

  </script>
</body>
</html>